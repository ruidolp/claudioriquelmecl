<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KidsPlay - Videos Seguros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos para YouTube tema claro */
        .youtube-red { background-color: #FF0000; }
        .youtube-bg { background-color: #ffffff; }
        .youtube-header { background-color: #ffffff; border-bottom: 1px solid #e5e5e5; }
        .youtube-sidebar { background-color: #f9f9f9; }
        .video-thumbnail:hover { cursor: pointer; }
        .video-thumbnail:hover img { opacity: 0.9; }
        
        /* Scrollbar personalizado para sidebar */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Botones hover */
        .btn-hover:hover {
            background-color: #f2f2f2;
        }
        
        .btn-active {
            background-color: #065fd4;
            color: white;
        }
        
        .btn-active:hover {
            background-color: #0a73e8;
        }

        /* Tamaños de video */
        #video-container {
            transition: all 0.3s ease;
        }
        
        .size-btn {
            font-weight: 500;
        }
        
        /* Modo cine - layout especial */
        .cinema-layout {
            flex-direction: column !important;
        }
        
        .cinema-layout #video-section {
            width: 100% !important;
            padding: 0 !important;
        }
        
        /* Contenedor para alinear sidebar a la derecha */
        .cinema-layout #sidebar {
            width: 400px !important;
            height: auto !important;
            max-height: 500px;
            padding: 0;
            margin-left: auto !important; /* Esto lo alinea a la derecha */
            margin-right: 20px !important;
            margin-top: 20px !important;
        }
        
        /* Contenedor de video en modo cine */
        .cinema-video {
            margin: 0 !important;
            max-width: 100% !important;
            border-radius: 0 !important;
        }
        
        /* Header sticky mejorado */
        .sidebar-header {
            background-color: #f9f9f9;
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
        }
        
        /* Contenedor scrollable */
        .sidebar-content {
            padding: 0 20px 20px 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* Indicador de video actual */
        .current-video {
            border-left: 3px solid #ff0000;
            background-color: #fff3f3;
        }
        
        .current-video-indicator {
            color: #ff0000;
            font-weight: 600;
        }
    </style>
</head>
<body class="youtube-bg text-gray-900 min-h-screen">
    <!-- Header -->
    <header class="youtube-header sticky top-0 z-50 px-4 py-2">
        <div class="flex items-center justify-between max-w-full">
            <!-- Logo y menú -->
            <div class="flex items-center space-x-4">
                <button class="p-2 hover:bg-gray-100 rounded-full">
                    <svg class="w-6 h-6 text-gray-700" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 youtube-red rounded flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </div>
                    <span class="text-xl font-bold text-gray-900">KidsPlay</span>
                </div>
            </div>

            <!-- Barra de búsqueda -->
            <div class="flex-1 max-w-2xl mx-8">
                <div class="flex">
                    <input 
                        type="text" 
                        placeholder="Buscar videos seguros..."
                        class="flex-1 px-4 py-2 border border-gray-300 rounded-l-full text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:outline-none bg-white"
                        disabled
                    >
                    <button class="px-6 py-2 bg-gray-50 border border-l-0 border-gray-300 rounded-r-full hover:bg-gray-100">
                        <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Controles derecha -->
            <div class="flex items-center space-x-4">
                <button class="p-2 hover:bg-gray-100 rounded-full">
                    <svg class="w-6 h-6 text-gray-700" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M14 6V4h-4v2h4zM4 8v11h16V8H4zm16-2c1.11 0 2 .89 2 2v11c0 1.11-.89 2-2 2H4c-1.11 0-2-.89-2-2l.01-11c0-1.11.88-2 1.99-2h16z"/>
                    </svg>
                </button>
                <button class="p-2 hover:bg-gray-100 rounded-full">
                    <svg class="w-6 h-6 text-gray-700" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                    </svg>
                </button>
                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-sm font-bold text-white">
                    K
                </div>
            </div>
        </div>
    </header>

    <!-- Contenido principal -->
    <div id="main-content" class="flex max-w-full">
        <!-- Video principal y info -->
        <div id="video-section" class="flex-1 p-6">
            <!-- Controles de tamaño -->
            <div class="flex justify-end mb-2">
                <div class="flex items-center space-x-2 bg-gray-100 rounded-lg p-1">
                    <button 
                        onclick="setVideoSize('small')" 
                        id="btn-small"
                        class="size-btn px-3 py-1 text-sm rounded hover:bg-gray-200 transition-colors"
                    >
                        Pequeño
                    </button>
                    <button 
                        onclick="setVideoSize('normal')" 
                        id="btn-normal"
                        class="size-btn px-3 py-1 text-sm rounded hover:bg-gray-200 transition-colors"
                    >
                        Normal
                    </button>
                    <button 
                        onclick="setVideoSize('large')" 
                        id="btn-large"
                        class="size-btn px-3 py-1 text-sm rounded hover:bg-gray-200 transition-colors"
                    >
                        Grande
                    </button>
                    <button 
                        onclick="setVideoSize('cinema')" 
                        id="btn-cinema"
                        class="size-btn px-3 py-1 text-sm rounded hover:bg-gray-200 transition-colors bg-blue-600 text-white"
                    >
                        Cine
                    </button>
                </div>
            </div>

            <!-- Video container -->
            <div id="video-container" class="bg-black rounded-xl overflow-hidden mb-4 transition-all duration-300">
                <div id="video-wrapper" class="relative w-full" style="padding-bottom: 56.25%;">
                    <div id="main-video" class="absolute top-0 left-0 w-full h-full"></div>
                </div>
            </div>

            <!-- Información del video -->
            <div class="mb-6">
                <h1 id="video-title" class="text-xl font-semibold mb-3 text-gray-900">
                    Cargando video...
                </h1>
                
                <!-- Stats y controles -->
                <div class="flex items-center justify-between mb-4">
                    <div class="text-gray-600 text-sm">
                        <span id="video-views">• Contenido seguro para niños</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="flex items-center space-x-2 px-6 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-900 font-medium">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/>
                            </svg>
                            <span>Me gusta</span>
                        </button>
                        <button class="flex items-center space-x-2 px-6 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-900 font-medium">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M22 16c0 1.1-.9 2-2 2H8l-4 4V6c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v10z"/>
                            </svg>
                            <span>No me gusta</span>
                        </button>
                        <button class="flex items-center space-x-2 px-6 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-900 font-medium">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                            </svg>
                            <span>Compartir</span>
                        </button>
                        <button class="flex items-center space-x-2 px-6 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-900 font-medium">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V7h10v2z"/>
                            </svg>
                            <span>Guardar</span>
                        </button>
                    </div>
                </div>

                <!-- Canal info -->
                <div class="flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 youtube-red rounded-full flex items-center justify-center font-bold text-lg text-white">
                            K
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">KidsPlay Oficial</h3>
                            <p class="text-gray-600 text-sm">Videos seguros seleccionados por papás y mamás</p>
                        </div>
                    </div>
                    <button class="btn-active px-6 py-2 rounded-full font-medium transition-colors">
                        Suscribirse
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar de videos -->
        <div id="sidebar" class="w-96 youtube-sidebar overflow-hidden h-screen">
            <div class="sidebar-header">
                <h2 class="text-lg font-semibold text-gray-900">Más videos seguros</h2>
            </div>
            
            <div class="sidebar-content">
                <div id="videos-sidebar" class="space-y-3">
                    <!-- Videos se cargarán aquí -->
                    <div class="skeleton h-24 rounded-lg"></div>
                    <div class="skeleton h-24 rounded-lg"></div>
                    <div class="skeleton h-24 rounded-lg"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- YouTube Player API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <script>
        // URLs simples - solo agregar/quitar URLs aquí
        const videoUrls = [
            "https://www.youtube.com/watch?v=9HVqZxU8waI",
            "https://youtu.be/rdUacwdA3_E", 
            "https://www.youtube.com/watch?v=AG5HnHE__5Y",
            "https://youtu.be/wuDW2jbMK4M"
        ];

        let currentVideoIndex = 0;
        let videos = [];
        let player = null;

        // Función para extraer ID de cualquier formato de URL de YouTube
        function extractVideoId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }

        // Función para convertir URLs a objetos simples
        function processVideoUrls(urls) {
            return urls.map((url, index) => ({
                id: extractVideoId(url),
                title: `Video Seguro ${index + 1}`,
                channel: "KidsPlay",
                views: `${Math.floor(Math.random() * 900 + 100)}K visualizaciones`,
                duration: `${Math.floor(Math.random() * 8 + 2)}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}`
            }));
        }

        // Función para mezclar array aleatoriamente
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Función que se ejecuta cuando la API de YouTube está lista
        function onYouTubeIframeAPIReady() {
            console.log('YouTube API cargada');
            loadVideos();
        }

        // Función para cargar videos aleatoriamente
        function loadVideos() {
            try {
                // Convertir URLs a objetos con metadata simple
                const processedVideos = processVideoUrls(videoUrls);
                
                // Mezclar videos aleatoriamente cada vez que se carga la página
                videos = shuffleArray(processedVideos);
                
                // Seleccionar video principal aleatorio
                currentVideoIndex = 0;
                
                displayVideos();
                createPlayer();
            } catch (error) {
                console.error('Error cargando videos:', error);
                showError();
            }
        }

        // Crear el reproductor de YouTube
        function createPlayer() {
            const video = videos[currentVideoIndex];
            
            if (player) {
                player.loadVideoById(video.id);
            } else {
                player = new YT.Player('main-video', {
                    height: '100%',
                    width: '100%',
                    videoId: video.id,
                    playerVars: {
                        'autoplay': 1,
                        'controls': 1,          // Mostrar controles
                        'rel': 0,               // No videos relacionados
                        'modestbranding': 0,    // Mostrar logo YouTube (para más opciones)
                        'fs': 1,                // Permitir pantalla completa
                        'cc_load_policy': 1,    // Mostrar subtítulos si están disponibles
                        'iv_load_policy': 3,    // Ocultar anotaciones
                        'autohide': 0,          // Siempre mostrar controles
                        'playsinline': 1,       // Para móviles
                        'enablejsapi': 1,       // Habilitar JavaScript API
                        'origin': window.location.origin,  // Para seguridad
                        'widget_referrer': window.location.href
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            }
            
            updateVideoInfo();
        }

        // Cuando el reproductor está listo
        function onPlayerReady(event) {
            console.log('Reproductor listo');
        }

        // Detectar cambios de estado del video
        function onPlayerStateChange(event) {
            console.log('Estado del video:', event.data);
            
            // Si el video terminó (estado = 0), pasar al siguiente
            if (event.data === YT.PlayerState.ENDED) {
                console.log('Video terminado, pasando al siguiente...');
                setTimeout(() => {
                    playNextVideo();
                }, 1000); // Esperar 1 segundo antes de cambiar
            }
        }

        // Reproducir siguiente video automáticamente
        function playNextVideo() {
            currentVideoIndex = (currentVideoIndex + 1) % videos.length;
            console.log('Reproduciendo video:', videos[currentVideoIndex].title);
            
            const nextVideo = videos[currentVideoIndex];
            player.loadVideoById(nextVideo.id);
            updateVideoInfo();
            displayVideos();
        }

        // Actualizar información del video
        function updateVideoInfo() {
            const video = videos[currentVideoIndex];
            document.getElementById('video-title').textContent = video.title;
            document.getElementById('video-views').textContent = video.views + ' • Contenido seguro';
        }

        // Función para mostrar videos en sidebar
        function displayVideos() {
            const sidebar = document.getElementById('videos-sidebar');
            sidebar.innerHTML = '';

            videos.forEach((video, index) => {
                const videoElement = createVideoElement(video, index);
                sidebar.appendChild(videoElement);
            });
        }

        // Crear elemento de video para sidebar
        function createVideoElement(video, index) {
            const div = document.createElement('div');
            const isCurrentVideo = index === currentVideoIndex;
            
            div.className = `video-thumbnail flex space-x-3 p-3 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors ${isCurrentVideo ? 'current-video' : ''}`;
            div.onclick = () => loadMainVideo(index);

            div.innerHTML = `
                <div class="flex-shrink-0 relative">
                    <img 
                        src="https://img.youtube.com/vi/${video.id}/mqdefault.jpg" 
                        alt="${video.title}"
                        class="w-40 h-24 object-cover rounded-lg transition-opacity"
                        onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cmVjdCB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiBmaWxsPSIjZjVmNWY1Ii8+CjxwYXRoIGQ9Ik02MCAzNkw5MCA1NEw2MCA3MlYzNloiIGZpbGw9IiNGRjAwMDAiLz4KPC9zdmc+'"
                    >
                    <span class="absolute bottom-1 right-1 bg-black bg-opacity-70 text-white text-xs px-1.5 py-0.5 rounded">
                        ${video.duration}
                    </span>
                    ${isCurrentVideo ? '<div class="absolute top-1 left-1 bg-red-600 text-white text-xs px-2 py-1 rounded">▶ Reproduciendo</div>' : ''}
                </div>
                <div class="flex-1 min-w-0">
                    <h3 class="text-sm font-medium ${isCurrentVideo ? 'current-video-indicator' : 'text-gray-900'} line-clamp-2 mb-2">
                        ${video.title}
                    </h3>
                    <p class="text-xs text-gray-600 mb-1">${video.channel}</p>
                    <p class="text-xs text-gray-600">${video.views}</p>
                </div>
            `;

            return div;
        }

        // Cargar video principal manualmente (click en sidebar)
        function loadMainVideo(index) {
            currentVideoIndex = index;
            const video = videos[index];
            
            // Cargar nuevo video en el reproductor
            if (player && player.loadVideoById) {
                player.loadVideoById(video.id);
            }
            
            updateVideoInfo();
            displayVideos();
        }

        // Mostrar error
        function showError() {
            const sidebar = document.getElementById('videos-sidebar');
            sidebar.innerHTML = `
                <div class="text-center p-4 text-gray-600">
                    <p>Error cargando videos</p>
                    <button onclick="loadVideos()" class="mt-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                        Reintentar
                    </button>
                </div>
            `;
        }

        // CSS para line-clamp (fallback)
        const style = document.createElement('style');
        style.textContent = `
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
        `;
        document.head.appendChild(style);

        // Inicializar cuando se carga la página - CADA VEZ ES ALEATORIO
        document.addEventListener('DOMContentLoaded', function() {
            // Si la API ya está cargada, inicializar inmediatamente
            if (window.YT && window.YT.Player) {
                loadVideos();
            }
            // Si no, onYouTubeIframeAPIReady se encargará
        });

        // Para debugging - mostrar orden actual de videos
        function showVideoOrder() {
            console.log('Orden actual de videos:', videos.map(v => v.title));
        }

        // Función para saltar manualmente al siguiente video (si quieres agregar un botón)
        function skipToNext() {
            playNextVideo();
        }

        // Control de tamaños del video
        function setVideoSize(size) {
            const container = document.getElementById('video-container');
            const wrapper = document.getElementById('video-wrapper');
            const mainContent = document.getElementById('main-content');
            const videoSection = document.getElementById('video-section');
            const sidebar = document.getElementById('sidebar');
            
            // Remover clase activa de todos los botones
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('text-gray-700');
            });
            
            // Activar botón seleccionado
            document.getElementById(`btn-${size}`).classList.add('bg-blue-600', 'text-white');
            document.getElementById(`btn-${size}`).classList.remove('text-gray-700');
            
            // Resetear clases
            mainContent.classList.remove('cinema-layout');
            container.classList.remove('cinema-video');
            container.style.maxWidth = '';
            container.style.marginLeft = '';
            container.style.marginRight = '';
            
            switch(size) {
                case 'small':
                    container.style.maxWidth = '640px';
                    wrapper.style.paddingBottom = '36%';
                    break;
                case 'normal':
                    container.style.maxWidth = '100%';
                    wrapper.style.paddingBottom = '56.25%';
                    break;
                case 'large':
                    container.style.maxWidth = '100%';
                    wrapper.style.paddingBottom = '65%';
                    break;
                case 'cinema':
                    // Aplicar layout de modo cine
                    mainContent.classList.add('cinema-layout');
                    container.classList.add('cinema-video');
                    wrapper.style.paddingBottom = '45%';
                    break;
            }
        }

        // Inicializar tamaño cine por defecto
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar modo cine como inicial
            setTimeout(() => {
                setVideoSize('cinema');
            }, 100);
        });
    </script>
</body>
</html>
